# Travis CI
#
#

sudo: required
dist: trusty
language: generic
python:
  - "2.7"

env:
  matrix:
     - "TESTLANG=C"
     - "TESTLANG=CSharp"
     - "TESTLANG=C++"
     - "TESTLANG=Clojure"
     - "TESTLANG=Crystal"
     - "TESTLANG=D"
     - "TESTLANG=Dart"
     - "TESTLANG=Elixir"
     - "TESTLANG=Erlang"
     - "TESTLANG=Go"
     - "TESTLANG=Groovy"
     - "TESTDIR=Haskell/snap"
     - "TESTDIR=Haskell/wai"
     - "TESTDIR=Haskell/yesod"
     - "TESTDIR=Haskell/servant"
     - "TESTDIR=Haskell/spock"
     - "TESTDIR=Java/act"
     - "TESTDIR=Java/activeweb"
     - "TESTDIR=Java/baratine"
     - "TESTDIR=Java/bayou"
     - "TESTDIR=Java/blade"
     - "TESTDIR=Java/comsat"
     - "TESTDIR=Java/curacao"
     - "TESTDIR=Java/dropwizard"
     - "TESTDIR=Java/gemini"
     - "TESTDIR=Java/grizzly"
     - "TESTDIR=Java/grizzly-jersey"
     - "TESTDIR=Java/jawn"
     - "TESTDIR=Java/jetty"
     - "TESTDIR=Java/jlhttp"
     - "TESTDIR=Java/jooby"
     - "TESTDIR=Java/light-java"
     - "TESTDIR=Java/minijax"
     - "TESTDIR=Java/netty"
     - "TESTDIR=Java/ninja-standalone"
     - "TESTDIR=Java/play1"
     - "TESTDIR=Java/play2-java"
     - "TESTDIR=Java/proteus"
     - "TESTDIR=Java/rapidoid"
     - "TESTDIR=Java/restexpress"
     - "TESTDIR=Java/revenj-jvm"
     - "TESTDIR=Java/servlet"
     - "TESTDIR=Java/spark"
     - "TESTDIR=Java/spring"
     - "TESTDIR=Java/tapestry"
     - "TESTDIR=Java/undertow"
     - "TESTDIR=Java/undertow-jersey"
     - "TESTDIR=Java/vertx"
     - "TESTDIR=Java/vertx-web"
     - "TESTDIR=Java/wicket"
     - "TESTDIR=Java/wildfly-ee7"
     - "TESTLANG=JavaScript"
     - "TESTLANG=Kotlin"
     - "TESTLANG=Lua"
     - "TESTLANG=Nim"
     - "TESTLANG=Perl"
     - "TESTDIR=PHP/cakephp"
     - "TESTDIR=PHP/hhvm"
     - "TESTDIR=PHP/php"
     - "TESTDIR=PHP/codeigniter"
     - "TESTDIR=PHP/cygnite"
     - "TESTDIR=PHP/clancats"
     - "TESTDIR=PHP/fat-free"
     - "TESTDIR=PHP/fuel"
     - "TESTDIR=PHP/kohana"
     - "TESTDIR=PHP/kumbiaphp"
     - "TESTDIR=PHP/laravel"
     - "TESTDIR=PHP/limonade"
     - "TESTDIR=PHP/lithium"
     - "TESTDIR=PHP/lumen"
     - "TESTDIR=PHP/peachpie"
     - "TESTDIR=PHP/phalcon"
     - "TESTDIR=PHP/phpixie"
     - "TESTDIR=PHP/silex"
     - "TESTDIR=PHP/slim"
     - "TESTDIR=PHP/symfony"
     - "TESTDIR=PHP/workerman"
     - "TESTDIR=PHP/yii2"
     - "TESTDIR=PHP/zend"
     - "TESTDIR=PHP/zend1"
     - "TESTDIR=PHP/phreeze"
     - "TESTDIR=Python/aiohttp"
     - "TESTDIR=Python/apistar"
     - "TESTDIR=Python/api_hour"
     - "TESTDIR=Python/bottle"
     - "TESTDIR=Python/cherrypy"
     - "TESTDIR=Python/django"
     - "TESTDIR=Python/falcon"
     - "TESTDIR=Python/flask"
     - "TESTDIR=Python/japronto"
     - "TESTDIR=Python/klein"
     - "TESTDIR=Python/morepath"
     - "TESTDIR=Python/pyramid"
     - "TESTDIR=Python/sanic"
     - "TESTDIR=Python/tornado"
     - "TESTDIR=Python/turbogears"
     - "TESTDIR=Python/uvicorn"
     - "TESTDIR=Python/uwsgi"
     - "TESTDIR=Python/web2py"
     - "TESTDIR=Python/webware"
     - "TESTDIR=Python/weppy"
     - "TESTDIR=Python/wheezyweb"
     - "TESTDIR=Python/wsgi"
     - "TESTLANG=Ruby"
     - "TESTLANG=Rust"
     - "TESTDIR=Scala/akka-http"
     - "TESTDIR=Scala/blaze"
     - "TESTDIR=Scala/colossus"
     - "TESTDIR=Scala/finagle"
     - "TESTDIR=Scala/finatra"
     - "TESTDIR=Scala/finch"
     - "TESTDIR=Scala/fintrospect"
     - "TESTDIR=Scala/http4s"
     - "TESTDIR=Scala/play2-scala"
     - "TESTLANG=Swift"
     - "TESTLANG=Ur"
     - "TESTLANG=Vala"

before_script:

  # Runs travis_diff, printing the output to the terminal, and searches for travis-diff-continue
  # to determine if the suite should be installed and the current $TESTDIR test should run.
  - export RUN_TESTS=`./toolset/travis/travis_diff.py | tee /dev/tty | grep -oP "travis-run-tests \K(.*)"`

  # travis_setup.sh runs all the same commands you would run if you were setting up
  # a development environment via:
  # http://frameworkbenchmarks.readthedocs.io/en/latest/Development/Installation-Guide/
  # it also stops a few conflicting services
  - if [ "$RUN_TESTS" ]; then source ./toolset/travis/travis_setup.sh; else echo 'Skipping travis_setup.sh'; fi

script:

  # run-ci.py runs the diffing to see if travis needs to test this framework. Ideally/eventually,
  # we'd like to try and do the diffing before travis_clean & setup.
  # This will run the tests exactly as you would in your own vm:
  # ./toolset/run-tests.py --mode verify --test (all the valid tests for this framework)
  - if [ "$RUN_TESTS" ]; then tfb --mode verify --test-dir $RUN_TESTS; else echo 'Skipping test verification.'; fi

cache:
  directories:
    - $HOME/.m2/repository
    - $HOME/.cache/pip
