<Project Sdk="Microsoft.NET.Sdk.Web">

  <!-- Defaults (non-AOT build) -->
  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <OutputType>Exe</OutputType>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>

    <!-- Default OFF unless enabled -->
    <AOT Condition="'$(AOT)'==''">false</AOT>

    <PublishAot>false</PublishAot>
    <SelfContained>false</SelfContained>
    <PublishTrimmed>false</PublishTrimmed>
    <TrimMode>partial</TrimMode>
  </PropertyGroup>

  <!-- AOT build -->
  <PropertyGroup Condition="'$(AOT)'=='true'">
    <PublishAot>true</PublishAot>
    <SelfContained>true</SelfContained>

    <!--TODOGITHUB-->
    <RuntimeIdentifier>linux-x64</RuntimeIdentifier> <!-- docker server -->
    <!--TODOLOCAL-->
    <!--<RuntimeIdentifier>linux-arm64</RuntimeIdentifier>--> <!-- docker local -->
    <!--<RuntimeIdentifier>osx-arm64</RuntimeIdentifier>--> <!-- outside docker local -->

    <PublishTrimmed>true</PublishTrimmed>
    <TrimMode>full</TrimMode>

    <OptimizationPreference>Size</OptimizationPreference>
    <IlcOptimizationPreference>Size</IlcOptimizationPreference>

    <DebuggerSupport>false</DebuggerSupport>
    <EventSourceSupport>false</EventSourceSupport>
    <HttpActivityPropagationSupport>false</HttpActivityPropagationSupport>
    <MetadataUpdaterSupport>false</MetadataUpdaterSupport>
    <MetricsSupport>false</MetricsSupport>
    <Http3Support>false</Http3Support>

    <InvariantGlobalization>true</InvariantGlobalization>
    <UseSystemResourceKeys>true</UseSystemResourceKeys>

    <StackTraceSupport>false</StackTraceSupport>
    <IlcGenerateStackTraceData>false</IlcGenerateStackTraceData>
    <TrimmerRemoveSymbols>true</TrimmerRemoveSymbols>
    <IlcScanReflection>false</IlcScanReflection>

    <DebugType>none</DebugType>
    <DebugSymbols>false</DebugSymbols>
    <StripSymbols>true</StripSymbols>

    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>

    <!-- Optional: also define a compile-time symbol -->
    <DefineConstants>$(DefineConstants);AOT</DefineConstants>
  </PropertyGroup>

  <ItemGroup>
    <RdXmlFile Include="rd.xml" />
  </ItemGroup>

  <ItemGroup>
    <None Include="appsettings.json" CopyToOutputDirectory="PreserveNewest" />

    <!--TODOLOCAL-->
    <!--
    <Content Include="../appMpower.Orm/bin/Release/net10.0/appMpower.Orm.dll">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </Content> 
    -->
    <!--TODOLOCAL AOT
    <Content Include="../appMpower.Orm/bin/Release/net10.0/osx-arm64/native/appMpower.Orm.dylib">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </Content> 
    -->
  </ItemGroup>

  <PropertyGroup>
      <DefineConstants Condition=" '$(AOTDLL)' == 'true' ">$(DefineConstants);AOTDLL</DefineConstants>
      <DefineConstants Condition=" '$(Driver)' == 'ado' ">$(DefineConstants);ADO</DefineConstants>
      <DefineConstants Condition=" '$(Driver)' == 'odbc' ">$(DefineConstants);ODBC</DefineConstants>
      <DefineConstants Condition=" '$(Database)' == 'postgresql' ">$(DefineConstants);POSTGRESQL</DefineConstants>
      <DefineConstants Condition=" '$(Database)' == 'mysql' ">$(DefineConstants);MYSQL</DefineConstants>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include = "..\appMpower.Orm\appMpower.Orm.csproj" />
    <!-- ADO + PostgreSQL -->
    <PackageReference Include="Npgsql" Version="10.0.0"
                      Condition="'$(Driver)' == 'ado' AND '$(Database)' == 'postgresql'" />
    <!-- ADO + MySQL -->
    <PackageReference Include="MySqlConnector" Version="2.5.0"
                      Condition="'$(Driver)' == 'ado' AND '$(Database)' == 'mysql'" />
  </ItemGroup>

</Project>