<Project Sdk="Microsoft.NET.Sdk">

  <!-- Defaults (non-AOTDLL build) -->
  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>

    <!-- Default OFF unless enabled -->
    <AOTDLL Condition="'$(AOTDLL)'==''">false</AOTDLL>

    <PublishAot>false</PublishAot>
    <SelfContained>false</SelfContained>
    <PublishTrimmed>false</PublishTrimmed>
    <TrimMode>partial</TrimMode>
  </PropertyGroup>

  <!-- AOTDLL build -->
  <PropertyGroup Condition="'$(AOTDLL)'=='true'">
    <PublishAot>true</PublishAot>
    <SelfContained>true</SelfContained>
    <!--TODOGITHUB-->
    <RuntimeIdentifier>linux-x64</RuntimeIdentifier> <!-- docker server -->
    <!--TODOLOCAL-->
    <!--<RuntimeIdentifier>linux-arm64</RuntimeIdentifier>--> <!-- docker local -->
    <!--<RuntimeIdentifier>osx-arm64</RuntimeIdentifier>--> <!-- outside docker local -->

    <PublishTrimmed>true</PublishTrimmed>
    <TrimMode>full</TrimMode>

    <OptimizationPreference>Size</OptimizationPreference>
    <IlcOptimizationPreference>Size</IlcOptimizationPreference>

    <DebuggerSupport>false</DebuggerSupport>
    <EventSourceSupport>false</EventSourceSupport>
    <HttpActivityPropagationSupport>false</HttpActivityPropagationSupport>
    <MetadataUpdaterSupport>false</MetadataUpdaterSupport>
    <MetricsSupport>false</MetricsSupport>
    <Http3Support>false</Http3Support>

    <InvariantGlobalization>true</InvariantGlobalization>
    <UseSystemResourceKeys>true</UseSystemResourceKeys>

    <StackTraceSupport>false</StackTraceSupport>
    <IlcGenerateStackTraceData>false</IlcGenerateStackTraceData>
    <TrimmerRemoveSymbols>true</TrimmerRemoveSymbols>

    <IlcScanReflection>false</IlcScanReflection>

    <DebugType>none</DebugType>
    <DebugSymbols>false</DebugSymbols>

    <StripSymbols>true</StripSymbols>

    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
  </PropertyGroup>

  <!-- show more specific warning
  <PropertyGroup>
     <TrimmerSingleWarn>false</TrimmerSingleWarn>
  </PropertyGroup>
  -->
  <PropertyGroup>
    <NoWarn>$(NoWarn);IL2093</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <RuntimeHostConfigurationOption Include="System.Threading.ThreadPool.HillClimbing.Disable" Value="true" />
  </ItemGroup>

  <PropertyGroup>
      <DefineConstants Condition=" '$(AOTDLL)' == 'true' ">$(DefineConstants);AOTDLL</DefineConstants>
      <DefineConstants Condition=" '$(Driver)' == 'ado' ">$(DefineConstants);ADO</DefineConstants>
      <DefineConstants Condition=" '$(Driver)' == 'odbc' ">$(DefineConstants);ODBC</DefineConstants>
      <DefineConstants Condition=" '$(Database)' == 'postgresql' ">$(DefineConstants);POSTGRESQL</DefineConstants>
      <DefineConstants Condition=" '$(Database)' == 'mysql' ">$(DefineConstants);MYSQL</DefineConstants>
  </PropertyGroup>

  <ItemGroup>
    <!-- ODBC -->
    <PackageReference Include="System.Data.Odbc" Version="10.0.1" 
                      Condition="'$(Driver)' == 'odbc'" />
    <!-- ADO + PostgreSQL -->
    <PackageReference Include="Npgsql" Version="10.0.0"
                      Condition="'$(Driver)' == 'ado' AND '$(Database)' == 'postgresql'" />
    <!-- ADO + MySQL -->
    <PackageReference Include="MySqlConnector" Version="2.5.0"
                      Condition="'$(Driver)' == 'ado' AND '$(Database)' == 'mysql'" />
  </ItemGroup>

</Project>